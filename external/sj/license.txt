Code adpoted from ATiN RATESI Frontiers2021 project by Stanislav Jiricek.
